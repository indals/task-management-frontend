<div class="task-list-container">
  <div class="task-list-header">
    <h2>Tasks</h2>
    <div class="header-actions">
      <button class="refresh-btn" (click)="refreshTasks()" [disabled]="isLoading">
        <i class="fas fa-sync-alt" [class.spinning]="isLoading"></i>
      </button>
      <button class="create-btn" (click)="createNewTask()">Create New Task</button>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-banner">
    {{ errorMessage }}
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading tasks...</p>
  </div>

  <!-- Filters -->
  <div class="filters" *ngIf="!isLoading">
    <div class="search-bar">
      <input 
        type="text" 
        placeholder="Search tasks..." 
        [(ngModel)]="searchTerm"
        (input)="onSearchChange(searchTerm)"
      >
    </div>
    
    <div class="status-filter">
      <label>Status: </label>
      <select [(ngModel)]="filterStatus" (change)="onStatusFilterChange(filterStatus)">
        <option *ngFor="let option of statusOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
    </div>
  </div>

  <!-- Task List -->
  <div class="task-list" *ngIf="!isLoading && filteredTasks.length > 0">
    <div 
      class="task-item" 
      *ngFor="let task of filteredTasks" 
      [ngClass]="task.status ? task.status.toLowerCase().replace('_', '-') : ''"
      (click)="viewTaskDetails(task.id)"
    >
      <div class="task-info">
        <h3>{{ task.title }}</h3>
        <p class="description" *ngIf="task.description">
          {{ task.description | slice:0:100 }}{{ task.description.length > 100 ? '...' : '' }}
        </p>
        <div class="meta-info">
          <span class="status" [ngClass]="task.status ? task.status.toLowerCase().replace('_', '-') : ''">
            {{ getStatusLabel(task.status) }}
          </span>
          <span class="due-date" *ngIf="task.due_date">
            Due: {{ task.due_date | date:'shortDate' }}
          </span>
          <span class="priority" [ngClass]="getPriorityClass(task.priority)">
            {{ getPriorityLabel(task.priority) }}
          </span>
          <span class="assignee" *ngIf="task.assigned_to">
            Assigned: {{ task.assigned_to.name }}
          </span>
        </div>
      </div>
      <div class="task-actions">
        <button class="edit-btn" (click)="$event.stopPropagation(); router.navigate(['/tasks/edit', task.id])">
          Edit
        </button>
        <button class="delete-btn" (click)="deleteTask(task.id, $event)">Delete</button>
      </div>
    </div>
  </div>

  <!-- No Tasks Message -->
  <div class="no-tasks" *ngIf="!isLoading && filteredTasks.length === 0 && tasks.length === 0">
    <div class="no-tasks-icon">📋</div>
    <h3>No tasks found</h3>
    <p>You don't have any tasks yet. Create your first task to get started!</p>
    <button class="create-btn" (click)="createNewTask()">Create New Task</button>
  </div>

  <!-- No Filtered Results -->
  <div class="no-tasks" *ngIf="!isLoading && filteredTasks.length === 0 && tasks.length > 0">
    <div class="no-tasks-icon">🔍</div>
    <h3>No matching tasks</h3>
    <p>Try adjusting your search or filter criteria.</p>
    <button class="clear-filters-btn" (click)="searchTerm = ''; filterStatus = 'all'; applyFilters()">
      Clear Filters
    </button>
  </div>
</div>