<div class="task-list-container">
  <!-- Header Section -->
  <div class="task-list-header">
    <div class="header-title">
      <h2>
        <i class="fas fa-tasks"></i>
        Tasks
        <span class="task-count" *ngIf="totalItems > 0">({{ totalItems }})</span>
      </h2>
      <div class="statistics-pills" *ngIf="statistics">
        <span class="pill completed">
          <i class="fas fa-check"></i>
          {{ statistics.completed }}
        </span>
        <span class="pill in-progress">
          <i class="fas fa-clock"></i>
          {{ statistics.in_progress }}
        </span>
        <span class="pill overdue" *ngIf="getOverdueTasksCount() > 0">
          <i class="fas fa-exclamation-triangle"></i>
          {{ getOverdueTasksCount() }}
        </span>
        <span class="pill completion-rate">
          <i class="fas fa-chart-line"></i>
          {{ getCompletionRate() }}%
        </span>
      </div>
    </div>
    
    <div class="header-actions">
      <button 
        class="btn btn-outline refresh-btn" 
        (click)="refreshTasks()" 
        [disabled]="isLoading"
        title="Refresh tasks"
      >
        <i class="fas fa-sync-alt" [class.spinning]="isLoading"></i>
      </button>
      
      <div class="view-mode-switcher">
        <button 
          class="btn btn-outline"
          [class.active]="viewMode === 'list'"
          (click)="onViewModeChange('list')"
          title="List view"
        >
          <i class="fas fa-list"></i>
        </button>
        <button 
          class="btn btn-outline"
          [class.active]="viewMode === 'cards'"
          (click)="onViewModeChange('cards')"
          title="Card view"
        >
          <i class="fas fa-th-large"></i>
        </button>
        <button 
          class="btn btn-outline"
          [class.active]="viewMode === 'kanban'"
          (click)="onViewModeChange('kanban')"
          title="Kanban view"
        >
          <i class="fas fa-columns"></i>
        </button>
      </div>
      
      <div class="export-dropdown dropdown">
        <button 
          class="btn btn-outline dropdown-toggle" 
          [disabled]="isExporting"
          data-bs-toggle="dropdown"
        >
          <i class="fas fa-download"></i>
          <span *ngIf="!isExporting">Export</span>
          <span *ngIf="isExporting">Exporting...</span>
        </button>
        <ul class="dropdown-menu">
          <li><a class="dropdown-item" (click)="exportTasks('csv')">CSV</a></li>
          <li><a class="dropdown-item" (click)="exportTasks('excel')">Excel</a></li>
          <li><a class="dropdown-item" (click)="exportTasks('pdf')">PDF</a></li>
        </ul>
      </div>
      
      <button class="btn btn-primary create-btn" (click)="createNewTask()">
        <i class="fas fa-plus"></i>
        Create Task
      </button>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="alert alert-danger alert-dismissible">
    <i class="fas fa-exclamation-circle"></i>
    {{ errorMessage }}
    <button 
      type="button" 
      class="btn-close" 
      (click)="errorMessage = null"
    ></button>
  </div>

  <!-- Filters Section -->
  <div class="filters-section" *ngIf="!isLoading">
    <div class="filters-row">
      <!-- Search -->
      <div class="search-container">
        <div class="input-group">
          <span class="input-group-text">
            <i class="fas fa-search"></i>
          </span>
          <input 
            type="text" 
            class="form-control"
            placeholder="Search tasks by title, description, or assignee..." 
            [(ngModel)]="searchTerm"
            (input)="onSearchChange($event.target.value)"
          >
          <button 
            class="btn btn-outline-secondary"
            *ngIf="searchTerm"
            (click)="searchTerm = ''; onSearchChange('')"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <!-- Quick Filters -->
      <div class="quick-filters">
        <select 
          class="form-select"
          [(ngModel)]="filters.status" 
          (change)="onFilterChange()"
        >
          <option *ngFor="let option of statusOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
        
        <select 
          class="form-select"
          [(ngModel)]="filters.priority" 
          (change)="onFilterChange()"
        >
          <option *ngFor="let option of priorityOptions" [value]="option.value">
            {{ option.label }}
          </option>
        </select>
        
        <select 
          class="form-select"
          [(ngModel)]="filters.assignee" 
          (change)="onFilterChange()"
        >
          <option value="">All Assignees</option>
          <option *ngFor="let user of users" [value]="user.id">
            {{ user.name }}
          </option>
        </select>
      </div>

      <!-- Advanced Filters Toggle -->
      <button 
        class="btn btn-outline-secondary advanced-filters-toggle"
        (click)="toggleAdvancedFilters()"
      >
        <i class="fas fa-filter"></i>
        <span>{{ showAdvancedFilters ? 'Hide' : 'Show' }} Filters</span>
      </button>

      <!-- Clear Filters -->
      <button 
        class="btn btn-outline-warning"
        (click)="clearFilters()"
        *ngIf="filters.status || filters.priority || filters.assignee || searchTerm"
      >
        <i class="fas fa-times"></i>
        Clear
      </button>
    </div>

    <!-- Advanced Filters Panel -->
    <div class="advanced-filters" *ngIf="showAdvancedFilters">
      <div class="row">
        <div class="col-md-3">
          <label class="form-label">Due Date</label>
          <input 
            type="date" 
            class="form-control"
            [(ngModel)]="filters.due_date"
            (change)="onFilterChange()"
          >
        </div>
        <div class="col-md-3">
          <label class="form-label">Created By</label>
          <select 
            class="form-select"
            [(ngModel)]="filters.created_by"
            (change)="onFilterChange()"
          >
            <option value="">All Creators</option>
            <option *ngFor="let user of users" [value]="user.id">
              {{ user.name }}
            </option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Project</label>
          <select 
            class="form-select"
            [(ngModel)]="filters.project_id"
            (change)="onFilterChange()"
          >
            <option value="">All Projects</option>
            <!-- Projects would be loaded here -->
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Items per page</label>
          <select 
            class="form-select"
            [(ngModel)]="pageSize"
            (change)="onPageSizeChange(pageSize)"
          >
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Bulk Actions Bar -->
  <div class="bulk-actions-bar" *ngIf="getSelectedTasksCount() > 0">
    <div class="selected-count">
      <i class="fas fa-check-square"></i>
      {{ getSelectedTasksCount() }} task(s) selected
    </div>
    <div class="bulk-actions">
      <button 
        *ngFor="let action of bulkActions"
        class="btn btn-sm"
        [class]="'btn-' + action.color"
        (click)="openBulkActionModal(action.key)"
        [disabled]="isPerformingBulkAction"
      >
        <i [class]="action.icon"></i>
        {{ action.label }}
      </button>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="loading-text">Loading tasks...</p>
  </div>

  <!-- Task Content -->
  <div class="task-content" *ngIf="!isLoading">
    <!-- List View -->
    <div *ngIf="viewMode === 'list'" class="list-view">
      <div class="table-responsive">
        <table class="table table-hover task-table">
          <thead>
            <tr>
              <th>
                <input 
                  type="checkbox" 
                  class="form-check-input"
                  [checked]="isAllTasksSelected()"
                  (change)="toggleAllTasksSelection()"
                >
              </th>
              <th 
                *ngFor="let column of columns" 
                [style.display]="column.visible ? 'table-cell' : 'none'"
                [class.sortable]="column.sortable"
                (click)="column.sortable ? onSort(column.key) : null"
              >
                {{ column.label }}
                <i 
                  *ngIf="column.sortable && sortBy === column.key"
                  class="fas"
                  [class.fa-sort-up]="sortDirection === 'asc'"
                  [class.fa-sort-down]="sortDirection === 'desc'"
                ></i>
              </th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr 
              *ngFor="let task of filteredTasks"
              class="task-row"
              [class.selected]="isTaskSelected(task.id)"
              (click)="viewTaskDetails(task.id)"
            >
              <td (click)="$event.stopPropagation()">
                <input 
                  type="checkbox" 
                  class="form-check-input"
                  [checked]="isTaskSelected(task.id)"
                  (change)="toggleTaskSelection(task.id)"
                >
              </td>
              <td *ngIf="columns.find(c => c.key === 'title')?.visible">
                <div class="task-title">
                  <strong>{{ task.title }}</strong>
                  <div class="task-description" *ngIf="task.description">
                    {{ task.description | slice:0:100 }}{{ task.description.length > 100 ? '...' : '' }}
                  </div>
                </div>
              </td>
              <td *ngIf="columns.find(c => c.key === 'assigned_user')?.visible">
                <div class="assignee-info" *ngIf="task.assigned_user">
                  <i class="fas fa-user"></i>
                  {{ task.assigned_user }}
                </div>
              </td>
              <td *ngIf="columns.find(c => c.key === 'priority')?.visible">
                <span 
                  class="badge priority-badge"
                  [style.background-color]="getPriorityColor(task.priority)"
                >
                  {{ task.priority }}
                </span>
              </td>
              <td *ngIf="columns.find(c => c.key === 'status')?.visible">
                <span 
                  class="badge status-badge"
                  [style.background-color]="getStatusColor(task.status)"
                >
                  {{ task.status }}
                </span>
              </td>
              <td *ngIf="columns.find(c => c.key === 'due_date')?.visible">
                <div class="due-date" *ngIf="task.due_date">
                  <i class="fas fa-calendar"></i>
                  {{ task.due_date | date:'shortDate' }}
                </div>
              </td>
              <td *ngIf="columns.find(c => c.key === 'created_at')?.visible">
                {{ task.created_at | date:'shortDate' }}
              </td>
              <td *ngIf="columns.find(c => c.key === 'updated_at')?.visible">
                {{ task.updated_at | date:'shortDate' }}
              </td>
              <td class="actions-cell" (click)="$event.stopPropagation()">
                <div class="dropdown">
                  <button 
                    class="btn btn-sm btn-outline-secondary dropdown-toggle"
                    data-bs-toggle="dropdown"
                  >
                    <i class="fas fa-ellipsis-v"></i>
                  </button>
                  <ul class="dropdown-menu">
                    <li><a class="dropdown-item" (click)="viewTaskDetails(task.id)">
                      <i class="fas fa-eye"></i> View
                    </a></li>
                    <li><a class="dropdown-item" (click)="editTask(task.id, $event)">
                      <i class="fas fa-edit"></i> Edit
                    </a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" (click)="quickStatusChange(task, 'COMPLETED', $event)">
                      <i class="fas fa-check"></i> Mark Complete
                    </a></li>
                    <li><a class="dropdown-item" (click)="quickStatusChange(task, 'IN_PROGRESS', $event)">
                      <i class="fas fa-play"></i> Start Progress
                    </a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item text-danger" (click)="deleteTask(task.id, $event)">
                      <i class="fas fa-trash"></i> Delete
                    </a></li>
                  </ul>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Card View -->
    <div *ngIf="viewMode === 'cards'" class="card-view">
      <div class="row">
        <div class="col-lg-4 col-md-6 mb-3" *ngFor="let task of filteredTasks">
          <div 
            class="card task-card"
            [class.selected]="isTaskSelected(task.id)"
            (click)="viewTaskDetails(task.id)"
          >
            <div class="card-header">
              <div class="d-flex justify-content-between align-items-start">
                <h6 class="card-title mb-0">{{ task.title }}</h6>
                <input 
                  type="checkbox" 
                  class="form-check-input"
                  [checked]="isTaskSelected(task.id)"
                  (change)="toggleTaskSelection(task.id)"
                  (click)="$event.stopPropagation()"
                >
              </div>
            </div>
            <div class="card-body">
              <p class="card-text" *ngIf="task.description">
                {{ task.description | slice:0:100 }}{{ task.description.length > 100 ? '...' : '' }}
              </p>
              <div class="task-meta">
                <span 
                  class="badge priority-badge"
                  [style.background-color]="getPriorityColor(task.priority)"
                >
                  {{ task.priority }}
                </span>
                <span 
                  class="badge status-badge"
                  [style.background-color]="getStatusColor(task.status)"
                >
                  {{ task.status }}
                </span>
              </div>
              <div class="task-details mt-2">
                <div class="assignee" *ngIf="task.assigned_user">
                  <i class="fas fa-user"></i>
                  {{ task.assigned_user }}
                </div>
                <div class="due-date" *ngIf="task.due_date">
                  <i class="fas fa-calendar"></i>
                  {{ task.due_date | date:'shortDate' }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredTasks.length === 0" class="empty-state">
      <div class="empty-state-content">
        <i class="fas fa-tasks empty-icon"></i>
        <h4>No tasks found</h4>
        <p>{{ searchTerm || filters.status || filters.priority ? 'Try adjusting your filters' : 'Create your first task to get started' }}</p>
        <button *ngIf="!searchTerm && !filters.status && !filters.priority" 
                class="btn btn-primary" 
                (click)="createNewTask()">
          <i class="fas fa-plus"></i>
          Create Task
        </button>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <nav *ngIf="!isLoading && totalPages > 1" class="pagination-container">
    <div class="pagination-info">
      Showing {{ (currentPage - 1) * pageSize + 1 }} to 
      {{ Math.min(currentPage * pageSize, totalItems) }} of {{ totalItems }} tasks
    </div>
    <ul class="pagination">
      <li class="page-item" [class.disabled]="currentPage === 1">
        <a class="page-link" (click)="onPageChange(currentPage - 1)">Previous</a>
      </li>
      <li 
        class="page-item" 
        *ngFor="let page of [].constructor(totalPages); let i = index"
        [class.active]="currentPage === i + 1"
      >
        <a class="page-link" (click)="onPageChange(i + 1)">{{ i + 1 }}</a>
      </li>
      <li class="page-item" [class.disabled]="currentPage === totalPages">
        <a class="page-link" (click)="onPageChange(currentPage + 1)">Next</a>
      </li>
    </ul>
  </nav>
</div>

<!-- Bulk Action Modal -->
<div class="modal fade" 
     [class.show]="showBulkActionModal" 
     [style.display]="showBulkActionModal ? 'block' : 'none'"
     *ngIf="showBulkActionModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ bulkActions.find(a => a.key === selectedBulkAction)?.label }}</h5>
        <button type="button" class="btn-close" (click)="closeBulkActionModal()"></button>
      </div>
      <div class="modal-body">
        <p>{{ getSelectedTasksCount() }} task(s) selected</p>
        
        <!-- Assign User -->
        <div *ngIf="selectedBulkAction === 'assign'">
          <label class="form-label">Select User</label>
          <select class="form-select" [(ngModel)]="bulkActionData.userId">
            <option value="">Select a user</option>
            <option *ngFor="let user of users" [value]="user.id">{{ user.name }}</option>
          </select>
        </div>
        
        <!-- Change Status -->
        <div *ngIf="selectedBulkAction === 'change_status'">
          <label class="form-label">Select Status</label>
          <select class="form-select" [(ngModel)]="bulkActionData.status">
            <option value="">Select status</option>
            <option *ngFor="let option of statusOptions.slice(1)" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>
        
        <!-- Change Priority -->
        <div *ngIf="selectedBulkAction === 'change_priority'">
          <label class="form-label">Select Priority</label>
          <select class="form-select" [(ngModel)]="bulkActionData.priority">
            <option value="">Select priority</option>
            <option *ngFor="let option of priorityOptions.slice(1)" [value]="option.value">
              {{ option.label }}
            </option>
          </select>
        </div>
        
        <!-- Delete Confirmation -->
        <div *ngIf="selectedBulkAction === 'delete'" class="alert alert-warning">
          <i class="fas fa-exclamation-triangle"></i>
          Are you sure you want to delete {{ getSelectedTasksCount() }} task(s)? This action cannot be undone.
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeBulkActionModal()">
          Cancel
        </button>
        <button 
          type="button" 
          class="btn btn-primary"
          (click)="executeBulkAction()"
          [disabled]="isPerformingBulkAction"
        >
          <span *ngIf="isPerformingBulkAction" class="spinner-border spinner-border-sm me-2"></span>
          {{ isPerformingBulkAction ? 'Processing...' : 'Confirm' }}
        </button>
      </div>
    </div>
  </div>
</div>
<div class="modal-backdrop fade show" *ngIf="showBulkActionModal"></div>