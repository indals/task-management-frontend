<!-- src/app/features/settings/settings.component.html -->
<div class="settings-container">
  <!-- Header -->
  <div class="settings-header">
    <h1>
      <mat-icon>settings</mat-icon>
      Settings
    </h1>
    <p>Customize your experience and manage your preferences</p>
  </div>

  <!-- Settings Tabs -->
  <mat-tab-group [(selectedIndex)]="selectedTabIndex" animationDuration="300ms" class="settings-tabs">
    
    <!-- General Settings -->
    <mat-tab label="General">
      <div class="tab-content">
        <form [formGroup]="generalForm" (ngSubmit)="saveGeneralSettings()" novalidate>
          
          <!-- Appearance Section -->
          <mat-card class="settings-section">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>palette</mat-icon>
                Appearance
              </mat-card-title>
              <mat-card-subtitle>
                Customize the look and feel of your interface
              </mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <div class="settings-row">
                <mat-form-field appearance="outline">
                  <mat-label>Theme</mat-label>
                  <mat-select formControlName="theme">
                    <mat-option value="light">
                      <div class="option-content">
                        <mat-icon>light_mode</mat-icon>
                        <span>Light Mode</span>
                      </div>
                    </mat-option>
                    <mat-option value="dark">
                      <div class="option-content">
                        <mat-icon>dark_mode</mat-icon>
                        <span>Dark Mode</span>
                      </div>
                    </mat-option>
                    <mat-option value="auto">
                      <div class="option-content">
                        <mat-icon>auto_mode</mat-icon>
                        <span>System Default</span>
                      </div>
                    </mat-option>
                  </mat-select>
                  <mat-hint>Choose your preferred color scheme</mat-hint>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Default View</mat-label>
                  <mat-select formControlName="defaultView">
                    <mat-option value="list">
                      <div class="option-content">
                        <mat-icon>view_list</mat-icon>
                        <span>List View</span>
                      </div>
                    </mat-option>
                    <mat-option value="grid">
                      <div class="option-content">
                        <mat-icon>view_module</mat-icon>
                        <span>Grid View</span>
                      </div>
                    </mat-option>
                    <mat-option value="kanban">
                      <div class="option-content">
                        <mat-icon>view_kanban</mat-icon>
                        <span>Kanban Board</span>
                      </div>
                    </mat-option>
                  </mat-select>
                  <mat-hint>Your preferred layout for viewing content</mat-hint>
                </mat-form-field>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Localization Section -->
          <mat-card class="settings-section">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>language</mat-icon>
                Localization
              </mat-card-title>
              <mat-card-subtitle>
                Set your language, timezone, and regional preferences
              </mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <div class="settings-row">
                <mat-form-field appearance="outline">
                  <mat-label>Language</mat-label>
                  <mat-select formControlName="language">
                    <mat-option value="en">
                      <div class="option-content">
                        <span class="flag">üá∫üá∏</span>
                        <span>English</span>
                      </div>
                    </mat-option>
                    <mat-option value="es">
                      <div class="option-content">
                        <span class="flag">üá™üá∏</span>
                        <span>Espa√±ol</span>
                      </div>
                    </mat-option>
                    <mat-option value="fr">
                      <div class="option-content">
                        <span class="flag">üá´üá∑</span>
                        <span>Fran√ßais</span>
                      </div>
                    </mat-option>
                    <mat-option value="de">
                      <div class="option-content">
                        <span class="flag">üá©üá™</span>
                        <span>Deutsch</span>
                      </div>
                    </mat-option>
                    <mat-option value="hi">
                      <div class="option-content">
                        <span class="flag">üáÆüá≥</span>
                        <span>‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</span>
                      </div>
                    </mat-option>
                  </mat-select>
                  <mat-hint>Select your preferred language</mat-hint>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Timezone</mat-label>
                  <mat-select formControlName="timezone">
                    <mat-option *ngFor="let tz of timezoneOptions" [value]="tz.value">
                      {{ tz.label }}
                    </mat-option>
                  </mat-select>
                  <mat-hint>Used for scheduling and timestamps</mat-hint>
                </mat-form-field>
              </div>

              <div class="settings-row">
                <mat-form-field appearance="outline">
                  <mat-label>Date Format</mat-label>
                  <mat-select formControlName="dateFormat">
                    <mat-option value="MM/DD/YYYY">MM/DD/YYYY (US)</mat-option>
                    <mat-option value="DD/MM/YYYY">DD/MM/YYYY (UK)</mat-option>
                    <mat-option value="YYYY-MM-DD">YYYY-MM-DD (ISO)</mat-option>
                    <mat-option value="DD MMM YYYY">DD MMM YYYY</mat-option>
                  </mat-select>
                  <mat-hint>How dates are displayed throughout the app</mat-hint>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>Time Format</mat-label>
                  <mat-select formControlName="timeFormat">
                    <mat-option value="12h">12 Hour (AM/PM)</mat-option>
                    <mat-option value="24h">24 Hour</mat-option>
                  </mat-select>
                  <mat-hint>Choose your time display format</mat-hint>
                </mat-form-field>
              </div>

              <div class="settings-row">
                <mat-form-field appearance="outline">
                  <mat-label>Week Starts On</mat-label>
                  <mat-select formControlName="weekStartDay">
                    <mat-option value="sunday">
                      <div class="option-content">
                        <mat-icon>today</mat-icon>
                        <span>Sunday</span>
                      </div>
                    </mat-option>
                    <mat-option value="monday">
                      <div class="option-content">
                        <mat-icon>today</mat-icon>
                        <span>Monday</span>
                      </div>
                    </mat-option>
                  </mat-select>
                  <mat-hint>First day of the week in calendars</mat-hint>
                </mat-form-field>
              </div>
            </mat-card-content>
          </mat-card>

          <div class="form-actions">
            <button mat-raised-button 
                    color="primary" 
                    type="submit" 
                    [disabled]="generalForm.invalid || isGeneralLoading"
                    [class.loading-state]="isGeneralLoading">
              <mat-spinner diameter="20" *ngIf="isGeneralLoading"></mat-spinner>
              <span *ngIf="!isGeneralLoading">Save Changes</span>
              <span *ngIf="isGeneralLoading">Saving...</span>
            </button>
          </div>
        </form>
      </div>
    </mat-tab>

    <!-- Notifications -->
    <mat-tab label="Notifications">
      <div class="tab-content">
        <form [formGroup]="notificationsForm" (ngSubmit)="saveNotificationSettings()" novalidate>
          
          <mat-card class="settings-section">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>notifications</mat-icon>
                Notification Preferences
              </mat-card-title>
              <mat-card-subtitle>
                Control how and when you receive notifications
              </mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              
              <!-- Delivery Methods -->
              <div class="notification-group">
                <h3>Delivery Methods</h3>
                <mat-slide-toggle formControlName="emailNotifications">
                  <div class="toggle-content">
                    <mat-icon>email</mat-icon>
                    <div>
                      <strong>Email Notifications</strong>
                      <p>Receive important updates and alerts via email</p>
                    </div>
                  </div>
                </mat-slide-toggle>

                <mat-slide-toggle formControlName="pushNotifications">
                  <div class="toggle-content">
                    <mat-icon>notifications_active</mat-icon>
                    <div>
                      <strong>Push Notifications</strong>
                      <p>Get instant browser notifications (requires permission)</p>
                    </div>
                  </div>
                </mat-slide-toggle>
              </div>

              <!-- Task & Project Notifications -->
              <div class="notification-group">
                <h3>Task & Project Updates</h3>
                <mat-slide-toggle formControlName="taskReminders">
                  <div class="toggle-content">
                    <mat-icon>alarm</mat-icon>
                    <div>
                      <strong>Task Reminders</strong>
                      <p>Get reminded about upcoming and overdue tasks</p>
                    </div>
                  </div>
                </mat-slide-toggle>

                <mat-slide-toggle formControlName="projectUpdates">
                  <div class="toggle-content">
                    <mat-icon>update</mat-icon>
                    <div>
                      <strong>Project Updates</strong>
                      <p>Notifications when projects you're involved in change</p>
                    </div>
                  </div>
                </mat-slide-toggle>

                <mat-slide-toggle formControlName="deadlineAlerts">
                  <div class="toggle-content">
                    <mat-icon>schedule</mat-icon>
                    <div>
                      <strong>Deadline Alerts</strong>
                      <p>Advanced warnings for approaching deadlines</p>
                    </div>
                  </div>
                </mat-slide-toggle>

                <mat-slide-toggle formControlName="teamMentions">
                  <div class="toggle-content">
                    <mat-icon>alternate_email</mat-icon>
                    <div>
                      <strong>Team Mentions</strong>
                      <p>When team members mention you in comments or discussions</p>
                    </div>
                  </div>
                </mat-slide-toggle>
              </div>

              <!-- Digest Notifications -->
              <div class="notification-group">
                <h3>Digest Reports</h3>
                <mat-slide-toggle formControlName="dailyDigest">
                  <div class="toggle-content">
                    <mat-icon>today</mat-icon>
                    <div>
                      <strong>Daily Digest</strong>
                      <p>End-of-day summary of your activities and pending tasks</p>
                    </div>
                  </div>
                </mat-slide-toggle>

                <mat-slide-toggle formControlName="weeklyReport">
                  <div class="toggle-content">
                    <mat-icon>date_range</mat-icon>
                    <div>
                      <strong>Weekly Report</strong>
                      <p>Comprehensive weekly productivity and achievement summary</p>
                    </div>
                  </div>
                </mat-slide-toggle>
              </div>

            </mat-card-content>
          </mat-card>

          <div class="form-actions">
            <button mat-raised-button 
                    color="primary" 
                    type="submit" 
                    [disabled]="notificationsForm.invalid || isNotificationsLoading"
                    [class.loading-state]="isNotificationsLoading">
              <mat-spinner diameter="20" *ngIf="isNotificationsLoading"></mat-spinner>
              <span *ngIf="!isNotificationsLoading">Save Notification Settings</span>
              <span *ngIf="isNotificationsLoading">Saving...</span>
            </button>
          </div>
        </form>
      </div>
    </mat-tab>

    <!-- Privacy -->
    <mat-tab label="Privacy">
      <div class="tab-content">
        <form [formGroup]="privacyForm" (ngSubmit)="savePrivacySettings()" novalidate>
          
          <mat-card class="settings-section">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>privacy_tip</mat-icon>
                Privacy & Data Control
              </mat-card-title>
              <mat-card-subtitle>
                Manage your privacy settings and control how your data is used
              </mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              
              <div class="privacy-group">
                <h3>Profile Visibility</h3>
                <mat-radio-group formControlName="profileVisibility" class="radio-group">
                  <mat-radio-button value="public">
                    <div class="radio-content">
                      <mat-icon>public</mat-icon>
                      <div>
                        <strong>Public Profile</strong>
                        <p>Your profile is visible to everyone in the organization</p>
                      </div>
                    </div>
                  </mat-radio-button>
                  <mat-radio-button value="team">
                    <div class="radio-content">
                      <mat-icon>group</mat-icon>
                      <div>
                        <strong>Team Members Only</strong>
                        <p>Only members of your teams can view your profile</p>
                      </div>
                    </div>
                  </mat-radio-button>
                  <mat-radio-button value="private">
                    <div class="radio-content">
                      <mat-icon>lock</mat-icon>
                      <div>
                        <strong>Private Profile</strong>
                        <p>Your profile is completely private and hidden from others</p>
                      </div>
                    </div>
                  </mat-radio-button>
                </mat-radio-group>
              </div>

              <div class="privacy-group">
                <h3>Data & Analytics</h3>
                <mat-slide-toggle formControlName="activityTracking">
                  <div class="toggle-content">
                    <mat-icon>track_changes</mat-icon>
                    <div>
                      <strong>Activity Tracking</strong>
                      <p>Allow tracking of your app usage to provide personalized insights</p>
                    </div>
                  </div>
                </mat-slide-toggle>

                <mat-slide-toggle formControlName="analytics">
                  <div class="toggle-content">
                    <mat-icon>analytics</mat-icon>
                    <div>
                      <strong>Usage Analytics</strong>
                      <p>Help improve the app with anonymous usage statistics</p>
                    </div>
                  </div>
                </mat-slide-toggle>

                <mat-slide-toggle formControlName="dataSharing">
                  <div class="toggle-content">
                    <mat-icon>share</mat-icon>
                    <div>
                      <strong>Third-Party Data Sharing</strong>
                      <p>Allow sharing of aggregated, anonymized data with trusted partners</p>
                    </div>
                  </div>
                </mat-slide-toggle>

                <mat-slide-toggle formControlName="marketingEmails">
                  <div class="toggle-content">
                    <mat-icon>campaign</mat-icon>
                    <div>
                      <strong>Marketing Communications</strong>
                      <p>Receive promotional emails, feature updates, and product news</p>
                    </div>
                  </div>
                </mat-slide-toggle>
              </div>

            </mat-card-content>
          </mat-card>

          <div class="form-actions">
            <button mat-raised-button 
                    color="primary" 
                    type="submit" 
                    [disabled]="privacyForm.invalid || isPrivacyLoading"
                    [class.loading-state]="isPrivacyLoading">
              <mat-spinner diameter="20" *ngIf="isPrivacyLoading"></mat-spinner>
              <span *ngIf="!isPrivacyLoading">Save Privacy Settings</span>
              <span *ngIf="isPrivacyLoading">Saving...</span>
            </button>
          </div>
        </form>
      </div>
    </mat-tab>

    <!-- Security -->
    <mat-tab label="Security">
      <div class="tab-content">
        <form [formGroup]="securityForm" (ngSubmit)="saveSecuritySettings()" novalidate>
          
          <mat-card class="settings-section">
            <mat-card-header>
              <mat-card-title>
                <mat-icon>security</mat-icon>
                Security & Access Control
              </mat-card-title>
              <mat-card-subtitle>
                Secure your account and manage access permissions
              </mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              
              <div class="security-group">
                <h3>Authentication</h3>
                <mat-slide-toggle formControlName="twoFactorAuth">
                  <div class="toggle-content">
                    <mat-icon>verified_user</mat-icon>
                    <div>
                      <strong>Two-Factor Authentication</strong>
                      <p>Add an extra layer of security with SMS or authenticator app verification</p>
                    </div>
                  </div>
                </mat-slide-toggle>

                <div class="settings-row">
                  <mat-form-field appearance="outline">
                    <mat-label>Session Timeout</mat-label>
                    <mat-select formControlName="sessionTimeout">
                      <mat-option [value]="5">5 minutes</mat-option>
                      <mat-option [value]="15">15 minutes</mat-option>
                      <mat-option [value]="30">30 minutes</mat-option>
                      <mat-option [value]="60">1 hour</mat-option>
                      <mat-option [value]="240">4 hours</mat-option>
                      <mat-option [value]="480">8 hours</mat-option>
                      <mat-option [value]="0">Never timeout</mat-option>
                    </mat-select>
                    <mat-hint>Automatically log out after period of inactivity</mat-hint>
                    <mat-error *ngIf="securityForm.get('sessionTimeout')?.hasError('min')">
                      Minimum timeout is 5 minutes
                    </mat-error>
                    <mat-error *ngIf="securityForm.get('sessionTimeout')?.hasError('max')">
                      Maximum timeout is 8 hours
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>

              <div class="security-group">
                <h3>Account Monitoring</h3>
                <mat-slide-toggle formControlName="loginNotifications">
                  <div class="toggle-content">
                    <mat-icon>login</mat-icon>
                    <div>
                      <strong>Login Notifications</strong>
                      <p>Get notified via email when someone logs into your account</p>
                    </div>
                  </div>
                </mat-slide-toggle>

                <mat-slide-toggle formControlName="apiAccess">
                  <div class="toggle-content">
                    <mat-icon>api</mat-icon>
                    <div>
                      <strong>API Access</strong>
                      <p>Allow third-party applications to access your data via API tokens</p>
                    </div>
                  </div>
                </mat-slide-toggle>
              </div>

              <div class="security-actions">
                <h3>Account Management</h3>
                <div class="action-buttons">
                  <button mat-raised-button 
                          color="accent" 
                          type="button" 
                          (click)="changePassword()"
                          class="action-button">
                    <mat-icon>lock_reset</mat-icon>
                    <span>Change Password</span>
                  </button>
                  
                  <button mat-raised-button 
                          type="button" 
                          (click)="viewLoginHistory()"
                          class="action-button">
                    <mat-icon>history</mat-icon>
                    <span>Login History</span>
                  </button>
                  
                  <button mat-raised-button 
                          type="button" 
                          (click)="downloadData()"
                          class="action-button">
                    <mat-icon>file_download</mat-icon>
                    <span>Export My Data</span>
                  </button>
                  
                  <button mat-raised-button 
                          color="warn" 
                          type="button" 
                          (click)="deleteAccount()"
                          class="action-button danger-button">
                    <mat-icon>delete_forever</mat-icon>
                    <span>Delete Account</span>
                  </button>
                </div>
              </div>

            </mat-card-content>
          </mat-card>

          <div class="form-actions">
            <button mat-raised-button 
                    color="primary" 
                    type="submit" 
                    [disabled]="securityForm.invalid || isSecurityLoading"
                    [class.loading-state]="isSecurityLoading">
              <mat-spinner diameter="20" *ngIf="isSecurityLoading"></mat-spinner>
              <span *ngIf="!isSecurityLoading">Save Security Settings</span>
              <span *ngIf="isSecurityLoading">Saving...</span>
            </button>
          </div>
        </form>
      </div>
    </mat-tab>

  </mat-tab-group>

  <!-- Success Message -->
  <div class="success-message" *ngIf="successMessage" [@fadeInOut]>
    <mat-icon>check_circle</mat-icon>
    <span>{{ successMessage }}</span>
  </div>
</div>